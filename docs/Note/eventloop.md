---
group: JavaScript
title: 事件循环
order: 2
---

# 浏览器的事件循环

> w3c 最新标准，取消了宏任务和微任务的说法。

在浏览器中，最繁忙的是渲染主进程。它要处理的任务：

- 解析 HTML
- 解析 CSS
- 计算样式
- 布局
- 分层
- 生成绘制指令
- 光栅化
- 绘制与显示
- 执行全局 js 代码
- 执行事件回调函数
- 执行计时器的回调函数
- ....

任务会排队，秉承先进先执行的原则。

执行一个任务就是一个事件循环。

但是这个过程是同步的，倘若执行的是计时器任务，不可能让渲染主线程一直等待计时结束再去执行下一个任务。

所以浏览器使用异步来解决这个问题。

当渲染主线程遇到计时器、网络请求、事件监听等任务时，会将该任务交给其他线程处理，自身结束当前任务，进入下一个事件循环，取下一个任务执行。等其他线程处理完被渲染主线程交予的任务后，将该任务的回调函数包装成任务添加到任务队列的末尾。

这样就能保证渲染主线程的不阻塞，提升用户体验。

在 w3c 的最新解释中，任务是分类型的，根据类型进入不同的任务队列，且任务队列是分优先级的。

- 微任务队列（最高）
- 交互事件队列（高）
- 延时队列（中）

在一次事件循环中，浏览器会根据实际情况从不同的队列中取出任务来执行。
